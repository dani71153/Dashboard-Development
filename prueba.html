<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Robot</title>
  <link rel="stylesheet" href="dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!--Zona de Librerias de Visualizacion 3D-->
  <!-- Pon esto en el <head> de tu dashboard o en la pesta√±a/secci√≥n 3D -->
<script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three/build/three.min.js"></script>
<script src=" https://cdn.jsdelivr.net/npm/@inweb/eventemitter2@26.10.6/dist/eventemitter2.min.js "></script>
<script src="https://cdn.jsdelivr.net/npm/easeljs@1.0.2/lib/easeljs.min.js"></script> <!-- a veces requerido -->
<script src="https://cdn.jsdelivr.net/npm/ros3d/build/ros3d.min.js"></script>
<!-- Usa estos CDNs modernos y compatibMotor motor2(M2_RPWM, M2_LPWM, M2_R_EN, M2_L_EN, M2_ENC_A, M2_ENC_B, 0.12, 0.18, 0.002, 25);
les -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
<!--Agregamos las librerias de ROS2DJS-->
<script src="https://cdn.jsdelivr.net/npm/ros2d/build/ros2d.min.js"></script>
<script src=" https://cdn.jsdelivr.net/npm/nav2d@1.4.0/dist/nav2d.min.js "></script>
<script src="mapa.js"></script>

</head>
<body>
  <nav>
    <div class="nav-meta">
      <span id="nav-imu-temp" class="nav-imu-temp">Temp: ‚Äî ¬∞C</span>
    </div>
    <ul>
      <li><a href="#graficas" data-tab="graficas">Gr√°ficas</a></li>
      <li><a href="#navegacion" data-tab="navegacion">Navegaci√≥n</a></li>
      <li><a href="#nodos_topicos" data-tab="nodos">Nodos</a></li>
      <li><a href="#monitoreo" data-tab="monitoreo">Monitoreo</a></li> <!-- NUEVO -->
      <li><a href="#control" data-tab="control">Control</a></li>
      <li><a href="#plano_xy" data-tab="plano_xy">Plano XY</a></li>
      <li><a href="#calibracion" data-tab="calibracion">Calibraci√≥n</a></li>
      <li><a href="#mapa" data-tab="mapa">Mapa</a></li>
    </ul>
  </nav>
  <aside id="estado-ros">
    <span id="ros-status">üî¥ Desconectado</span>
    <span id="topic-status">‚Äî</span>
  </aside>
  
  <main>
    <section id="graficas">
      <h2>Visualizaci√≥n de Gr√°ficas</h2>
      <div style="display: flex; gap: 2rem;">
        <aside id="aside-graficas" style="min-width: 160px;">
          <h3>Conjuntos de gr√°ficas</h3>
          <button class="boton-grafica" data-tipo="odometro">Od√≥metro</button>
          <button class="boton-grafica" data-tipo="encoders">Encoders</button>
          <button class="boton-grafica" data-tipo="motores">Motores</button>
          <button class="boton-grafica" data-tipo="bateria">Bater√≠a</button>
          <button class="boton-grafica" data-tipo="temperatura">Temperatura</button>
          <button class="boton-grafica" data-tipo="mpu">MPU</button>

        </aside>
        <div id="contenedor-graficas">
          <!-- Un solo div visible a la vez, seg√∫n el conjunto seleccionado -->
          <div id="graficas-odometro" style="display:none;gap:2rem;flex-wrap:wrap;">
            <div>
              <canvas id="grafica-rueda-1" width="350" height="160"></canvas>
              <div style="text-align:center">Rueda 1</div>
            </div>
            <div>
              <canvas id="grafica-rueda-2" width="350" height="160"></canvas>
              <div style="text-align:center">Rueda 2</div>
            </div>
            <div>
              <canvas id="grafica-rueda-3" width="350" height="160"></canvas>
              <div style="text-align:center">Rueda 3</div>
            </div>
            <div>
              <canvas id="grafica-rueda-4" width="350" height="160"></canvas>
              <div style="text-align:center">Rueda 4</div>
            </div>
            <div id="odometria-stats">
              <b>Resumen global<br>(√∫ltimos <span id="stat-hist-n"></span> muestras por rueda)</b><br>
              <span id="stat-max-block" style="color:#08d;">M√°x: <span id="stat-max"></span></span> m/s<br>
              <span id="stat-min-block" style="color:#08d;">M√≠n: <span id="stat-min"></span></span> m/s<br>
              <span id="stat-avg-block" style="color:#08d;">Promedio: <span id="stat-avg"></span></span> m/s
              <hr style="margin:0.5em 0;">
              <div id="stats-detalles">
                <span id="detalle-rueda-1"></span>
                <span id="detalle-rueda-2"></span>
                <span id="detalle-rueda-3"></span>
                <span id="detalle-rueda-4"></span>
              </div>
            </div>
                        <div id="controles-odometro" style="display:flex; flex-direction:column; gap:0.5em; margin-left:1.5em;">
              <label>
                <b>Velocidad M√°x (m/s):</b>
                <input id="input-max-vel" type="number" min="0" max="1" step="0.01" value="0.11" style="width: 60px;">
              </label>
              <label>
                <b>Velocidad M√≠n (m/s):</b>
                <input id="input-min-vel" type="number" min="-1" max="0" step="0.01" value="-0.11" style="width: 60px;">
              </label>
              <label>
                <input id="toggle-maxline" type="checkbox" checked>
                Mostrar l√≠nea m√°xima
              </label>
              <label>
                <input id="toggle-minline" type="checkbox" checked>
                Mostrar l√≠nea m√≠nima
              </label>
              <label>
                <input id="toggle-fixed-scale-ruedas" type="checkbox">
                Fijar escala ruedas
              </label>
            </div>
            
          </div>


          <div id="graficas-encoders" style="display:none;gap:2rem;flex-wrap:wrap;">
            <div>
              <canvas id="grafica-encoder-1" width="350" height="160"></canvas>
              <div style="text-align:center">Encoder 1</div>
            </div>
            <div>
              <canvas id="grafica-encoder-2" width="350" height="160"></canvas>
              <div style="text-align:center">Encoder 2</div>
            </div>
            <div>
              <canvas id="grafica-encoder-3" width="350" height="160"></canvas>
              <div style="text-align:center">Encoder 3</div>
            </div>
            <div>
              <canvas id="grafica-encoder-4" width="350" height="160"></canvas>
              <div style="text-align:center">Encoder 4</div>
            </div>
            <div id="encoders-stats">
              <b>Resumen global<br>(√∫ltimos <span id="enc-stat-hist-n">20</span> muestras por encoder)</b><br>
              <span style="color:#08d;">M√°x: <span id="enc-stat-max"></span></span><br>
              <span style="color:#08d;">M√≠n: <span id="enc-stat-min"></span></span><br>
              <span style="color:#08d;">Promedio: <span id="enc-stat-avg"></span></span>
              <hr style="margin:0.5em 0;">
              <div id="encoders-detalles">
                <span id="detalle-encoder-1"></span>
                <span id="detalle-encoder-2"></span>
                <span id="detalle-encoder-3"></span>
                <span id="detalle-encoder-4"></span>
              </div>
            </div>
            <div id="controles-encoders" style="display:flex; flex-direction:column; gap:0.5em; margin-left:1.5em;">
              <label>
                <b>Posici√≥n M√°x (rad):</b>
                <input id="input-max-enc" type="number" step="0.01" value="10" style="width: 80px;">
              </label>
              <label>
                <b>Posici√≥n M√≠n (rad):</b>
                <input id="input-min-enc" type="number" step="0.01" value="-10" style="width: 80px;">
              </label>
              <label>
                <input id="toggle-maxline-enc" type="checkbox" checked>
                Mostrar l√≠nea m√°xima
              </label>
              <label>
                <input id="toggle-minline-enc" type="checkbox" checked>
                Mostrar l√≠nea m√≠nima
              </label>
              <button id="reset-encoders-time" style="margin-top:0.5em; padding:0.5em 1em; background:#eee; border-radius:8px; border:1px solid #ccc;">
                Reiniciar tiempo
              </button>
              <button id="toggle-modular-enc" style="margin-top:1em; padding:0.5em 1em; background:#eee; border-radius:8px; border:1px solid #ccc;">
                Ver modo modular
              </button>
              <button id="toggle-unidad-enc" style="margin-top:0.5em; padding:0.5em 1em; background:#eee; border-radius:8px; border:1px solid #ccc;">
                Ver en ticks
              </button>
              
            </div>
          </div>
          
          <div id="graficas-motores" style="display:none;gap:2rem;flex-wrap:wrap;">
            <div>
              <canvas id="grafica-corriente-1" width="350" height="160"></canvas>
              <div style="text-align:center">Motor 1</div>
            </div>
            <div>
              <canvas id="grafica-corriente-2" width="350" height="160"></canvas>
              <div style="text-align:center">Motor 2</div>
            </div>
            <div>
              <canvas id="grafica-corriente-3" width="350" height="160"></canvas>
              <div style="text-align:center">Motor 3</div>
            </div>
            <div>
              <canvas id="grafica-corriente-4" width="350" height="160"></canvas>
              <div style="text-align:center">Motor 4</div>
            </div>
            <div id="corriente-stats">
              <!-- Las estad√≠sticas y controles de offset se llenan por JS -->
            </div>
            <div id="controles-motores" style="display:flex; flex-direction:column; gap:0.5em; margin-left:1.5em;">
              <label>
                <b>Corriente M√°x (A):</b>
                <input id="input-max-corr" type="number" step="0.01" value="4.5" style="width: 80px;">
              </label>
              <label>
                <b>Corriente M√≠n (A):</b>
                <input id="input-min-corr" type="number" step="0.01" value="0" style="width: 80px;">
              </label>
              <label>
                <input id="toggle-maxline-corr" type="checkbox" checked>
                Mostrar l√≠nea m√°xima
              </label>
              <label>
                <input id="toggle-minline-corr" type="checkbox" checked>
                Mostrar l√≠nea m√≠nima
              </label>
            </div>
            
          </div>
          
          <div id="graficas-mpu" style="display:none;gap:2rem;flex-wrap:wrap;">
            <div>
              <canvas id="grafica-aceleracion" width="340" height="150"></canvas>
              <div style="text-align:center;">Aceleraci√≥n lineal (m/s¬≤)</div>
            </div>
            <div>
              <canvas id="grafica-giroscopio" width="340" height="150"></canvas>
              <div style="text-align:center;">Velocidad angular (rad/s)</div>
            </div>
            <div>
              <canvas id="grafica-orientacion" width="340" height="150"></canvas>
              <div style="text-align:center;">Orientaci√≥n (Euler ¬∞)</div>
            </div>
            <div id="mpu-stats"></div>
            <div id="controles-mpu" style="display:flex; flex-direction:column; gap:0.5em; min-width:220px;">
              <label>
                <b>M√°x (acel m/s¬≤):</b>
                <input id="input-max-acel" type="number" step="0.1" value="20" style="width:70px;">
              </label>
              <label>
                <b>M√≠n (acel m/s¬≤):</b>
                <input id="input-min-acel" type="number" step="0.1" value="-20" style="width:70px;">
              </label>
              <label>
                <input id="toggle-maxline-acel" type="checkbox" checked>
                Mostrar l√≠nea m√°xima
              </label>
              <label>
                <input id="toggle-minline-acel" type="checkbox" checked>
                Mostrar l√≠nea m√≠nima
              </label>
              <hr style="margin:0.6em 0;">
              <label>
                <b>M√°x (gyro rad/s):</b>
                <input id="input-max-gyro" type="number" step="0.1" value="10" style="width:70px;">
              </label>
              <label>
                <b>M√≠n (gyro rad/s):</b>
                <input id="input-min-gyro" type="number" step="0.1" value="-10" style="width:70px;">
              </label>
              <label>
                <input id="toggle-maxline-gyro" type="checkbox" checked>
                Mostrar l√≠nea m√°xima
              </label>
              <label>
                <input id="toggle-minline-gyro" type="checkbox" checked>
                Mostrar l√≠nea m√≠nima
              </label>
            </div>
            
          </div>
          
          <div id="graficas-unicas" style="">
            <canvas id="miGrafica"></canvas>
            <pre id="datos-ros"></pre>
          </div>
        </div>
        
      </div>
    </section>
    
    <section id="nodos_topicos">
      <h2>Nodos y T√≥picos ROS</h2>
      <button id="btn-actualizar-nodos-topicos" style="margin-bottom:1em;">Actualizar</button>
      <div style="display:flex; gap:2em;">
        <div style="flex:1;">
          <h3>T√≥picos</h3>
          <div id="contenedor-topicos"></div>
        </div>
        <div style="flex:1;">
          <h3>Nodos</h3>
          <div id="contenedor-nodos"></div>
        </div>
        <div style="flex:1; min-width:220px;">
          <h3>Consulta de Informaci√≥n</h3>
          <select id="dropdown-seleccion" style="width:100%; margin-bottom:0.8em;">
            <option value="" disabled selected>Selecciona nodo o t√≥pico</option>
          </select>
          <select id="dropdown-comando">
            <option value="" disabled selected>Selecciona comando</option>
            <option value="info">Info</option>
            <option value="publishers">Publishers</option>
            <option value="subscribers">Subscribers</option>
            <option value="node_topics">Node Topics</option>
            <option value="topic_type">Topic Type</option>
            <option value="topic_types">All Topic Types</option>
            <option value="services">Servicios</option>
            <option value="service_type">Service Type</option>
          </select>
          <button id="btn-consultar-comando" style="margin-bottom:0.7em;">Consultar</button>
          <div id="resultado-comando" 
          style="font-family:monospace; font-size:1em; background:#f5f6fa; min-height:80px; padding:8px 10px; border-radius:6px; color:#111;"></div>
      <div id="monitor-dinamico" style="margin-top:2em;">
            <h3>Monitor de T√≥picos en Tiempo Real</h3>
            <div style="display:flex; gap:1em;">
              <div>
                <label for="monitor-dropdown-topico"><b>Selecciona T√≥pico:</b></label><br>
                <select id="monitor-dropdown-topico" style="min-width:220px;"></select>
                <button id="monitor-add-btn" style="margin-left:1em;">Monitorear</button>
              </div>
            </div>
            <div id="monitor-lista-topicos" style="margin-top:1.5em;"></div>
          </div>
          
        
        </div>
      </div>
    </section>

    
    <section id="control">
      <h2>Control Manual</h2>
      <div style="margin-bottom:1em; padding:0.7em 1em; border:1px solid #ccc; border-radius:8px; background:#f8f8f8;">
        <label for="control-enable" style="display:flex; align-items:center; gap:0.6em; font-weight:600;">
          <input type="checkbox" id="control-enable" style="transform: scale(1.2);">
          Habilitar control manual
        </label>
        <small style="display:block; margin-top:0.35em; color:#666;">
          Activa este interruptor para poder enviar comandos al robot. Se mantiene deshabilitado por seguridad.
        </small>
      </div>
      <div style="margin-bottom:1em;">
        <label for="topic-select"><b>T√≥pico de Control:</b></label>
        <input type="text" id="topic-select" value="/diff_drive_controller/cmd_vel" style="width: 140px;">
        <label for="publish-rate"><b>Frecuencia (Hz):</b></label>
        <input type="number" id="publish-rate" min="1" max="30" value="10" style="width: 60px;">
        <span id="current-topic" style="color: #666; font-size: 0.95em;"></span>
      </div>
      <div style="display:flex; gap:2em; align-items: flex-start;">
        <div style="display:grid; grid-template-areas: 
            'fwd fwd'
            'left right'
            'back back'
            'stop stop'; gap:0.5em; align-items:center;">
          <button id="btn-forward"  style="grid-area:fwd;">‚ñ≤ Adelante</button>
          <button id="btn-left"     style="grid-area:left;">‚óÄÔ∏è Giro Antihorario</button>
          <button id="btn-right"    style="grid-area:right;">‚ñ∂Ô∏è Giro Horario</button>
          <button id="btn-back"     style="grid-area:back;">‚ñº Atr√°s</button>
          <button id="btn-stop"     style="grid-area:stop;">‚èπÔ∏è Parar</button>
        </div>
        <div>
          <label>Velocidad Lineal (m/s):</label><br>
          <input type="range" id="slider-linear" min="-0.11" max="0.11" step="0.01" value="0.05" style="width:120px;">
          <input type="number" id="input-linear" min="-0.11" max="0.11" step="0.01" value="0.05" style="width:55px;">
          <br><br>
          <label>Velocidad Angular (rad/s):</label><br>
          <input type="range" id="slider-angular" min="-0.45" max="0.45" step="0.01" value="0.2" style="width:120px;">
          <input type="number" id="input-angular" min="-0.45" max="0.45" step="0.01" value="0.2" style="width:55px;">
          <br><br>
          <small>Puedes usar tambi√©n teclas <b>W/A/S/D</b> para mover, <b>Espacio</b> para parar.</small>
          <div id="control-status" style="margin-top:0.5em;color:#c00;font-size:0.96em;"></div>
        </div>
        <div class="lidar-card">
          <div class="lidar-card-header">
            <h4>LiDAR</h4>
            <span id="lidar-status-chip" class="lidar-status-chip lidar-status-off">Apagado</span>
          </div>
          <p id="lidar-status-text" class="lidar-status-text">Sin conexi√≥n con ROS.</p>
          <div class="lidar-actions">
            <button id="btn-lidar-start" class="lidar-action-btn">Encender LiDAR</button>
            <button id="btn-lidar-stop" class="lidar-action-btn lidar-action-stop">Detener LiDAR</button>
          </div>
          <small class="lidar-hint">Opera sobre los servicios `/start_motor` y `/stop_motor` del driver.</small>
        </div>
      </div>
      <div style="margin-top:1em; font-size:0.97em;">
        <b>Estado de publicaci√≥n:</b>
        <span id="pub-status" style="color:#666;"></span>
      </div>
    </section>

    <section id="navegacion" style="display:none;">
      <h2>Monitoreo de Navegaci√≥n</h2>
      <div class="navx-layout">
        <aside class="navx-sidebar">
          <button class="navx-io-btn active" data-target="salidas">Salidas</button>
          <button class="navx-io-btn" data-target="entradas">Entradas</button>
        </aside>
        <div class="navx-content">
          <div id="nav-io-salidas" class="navx-panel" data-active>
            <nav class="navx-salidas-tabs">
              <button class="navx-tab-btn active" data-panel="velocidades">Velocidades</button>
              <button class="navx-tab-btn" data-panel="frecuencia">Frecuencia</button>
              <button class="navx-tab-btn" data-panel="aceleraciones">Aceleraciones</button>
              <button class="navx-tab-btn" data-panel="consola">Consola</button>
            </nav>
            <div class="navx-panel-group">
              <div id="nav-salidas-velocidades" class="navx-panel-item active">
                <div class="navx-vel-mode">
                  <button id="nav-vel-mode-linear" class="navx-vel-mode-btn active" type="button">Velocidad lineal</button>
                  <button id="nav-vel-mode-angular" class="navx-vel-mode-btn" type="button">Velocidad angular</button>
                </div>
                <div class="navx-chart-grid navx-chart-grid-vel">
                  <div class="navx-chart-card navx-chart-card-accent">
                    <canvas id="nav-chart-cmd-vel-smoothed" width="460" height="240"></canvas>
                    <div class="navx-chart-caption">/cmd_vel_smoothed</div>
                  </div>
                  <div class="navx-chart-card navx-chart-card-accent">
                    <canvas id="nav-chart-diff-cmd-vel" width="460" height="240"></canvas>
                    <div class="navx-chart-caption">/diff_drive_controller/cmd_vel</div>
                  </div>
                  <div class="navx-chart-card">
                    <canvas id="nav-chart-cmd-vel" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">/cmd_vel</div>
                  </div>
                  <div class="navx-chart-card">
                    <canvas id="nav-chart-cmd-vel-teleop" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">/cmd_vel_teleop</div>
                  </div>
                </div>
              </div>
              <div id="nav-salidas-frecuencia" class="navx-panel-item">
                <button id="nav-freq-toggle-mode" class="navx-vel-mode-btn" type="button">Mostrar en Hz</button>
                <div class="navx-chart-card navx-chart-card-wide">
                  <canvas id="nav-chart-odom-timestamp" width="640" height="220"></canvas>
                  <div class="navx-chart-caption">Œît entre mensajes de /odometry/filtered</div>
                </div>
                <p class="navx-panel-hint">Los puntos resaltados en rojo indican discontinuidades en el timestamp.</p>
              </div>
              <div id="nav-salidas-aceleraciones" class="navx-panel-item">
                <button id="nav-accel-toggle-high" class="navx-vel-mode-btn" type="button">Ocultar ruedas 3 y 4</button>
                <div class="navx-chart-grid navx-chart-grid-vel">
                  <div class="navx-chart-card" id="nav-accel-card-1">
                    <canvas id="nav-chart-wheel-accel-1" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">Rueda 1</div>
                  </div>
                  <div class="navx-chart-card" id="nav-accel-card-2">
                    <canvas id="nav-chart-wheel-accel-2" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">Rueda 2</div>
                  </div>
                  <div class="navx-chart-card" id="nav-accel-card-3">
                    <canvas id="nav-chart-wheel-accel-3" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">Rueda 3</div>
                  </div>
                  <div class="navx-chart-card" id="nav-accel-card-4">
                    <canvas id="nav-chart-wheel-accel-4" width="420" height="220"></canvas>
                    <div class="navx-chart-caption">Rueda 4</div>
                  </div>
                </div>
                <p class="navx-panel-hint">Se calcula como a = (velocidad_actual ‚àí velocidad_anterior) / Œît para cada rueda.</p>
              </div>
              <div id="nav-salidas-consola" class="navx-panel-item">
                <div class="navx-console">
                  <h3>Comandos ROS 2 para depuraci√≥n</h3>
                  <ul>
                    <li><code>ros2 topic echo /cmd_vel</code></li>
                    <li><code>ros2 topic echo /cmd_vel_smoothed</code></li>
                    <li><code>ros2 topic echo /cmd_vel_teleop</code></li>
                    <li><code>ros2 topic echo /diff_drive_controller/cmd_vel</code></li>
                    <li><code>ros2 topic hz /odometry/filtered</code></li>
                    <li><code>ros2 topic hz /cmd_vel</code></li>
                    <li><code>ros2 topic hz /cmd_vel_smoothed</code></li>
                    <li><code>ros2 topic echo /joint_states</code></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div id="nav-io-entradas" class="navx-panel" style="display:none;">
            <div class="navx-empty">
              <h3>Entradas</h3>
              <p>Esta secci√≥n se conectar√° m√°s adelante a los nodos de entrada. Por ahora permanece desconectada.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section id="plano_xy" style="display:none;">
      <h2>Plano XY Interactivo</h2>
      <div class="xyviz-layout">
        <aside class="xyviz-sidebar">
          <div class="xyviz-card">
            <h3>Opciones de vista</h3>
            <button type="button" id="xyviz-axis-toggle" class="xyviz-btn">Ejes: X‚ÜîY</button>
            <div class="xyviz-zoom-controls">
              <button type="button" id="xyviz-zoom-in" class="xyviz-btn">Acercar (+)</button>
              <button type="button" id="xyviz-zoom-out" class="xyviz-btn">Alejar (‚àí)</button>
              <button type="button" id="xyviz-reset-view" class="xyviz-btn">Recentrar vista</button>
            </div>
            <small class="xyviz-note">El modo est√°ndar muestra eje X horizontal y eje Y vertical. Con el bot√≥n puedes intercambiarlos din√°micamente.</small>
            <small class="xyviz-note">Usa la rueda del mouse para hacer zoom y arrastra sobre el plano para desplazarte. Tambi√©n puedes usar W/A/S/D para mover la vista.</small>
          </div>
          <div class="xyviz-card">
            <h3>Landmarks</h3>
            <form id="xyviz-landmark-form" class="xyviz-form">
              <label class="xyviz-field">
                <span>Nombre</span>
                <input type="text" id="xyviz-landmark-name" maxlength="32" placeholder="Punto" required>
              </label>
              <label class="xyviz-field">
                <span>X (m)</span>
                <input type="number" id="xyviz-landmark-x" step="0.01" value="0" required>
              </label>
              <label class="xyviz-field">
                <span>Y (m)</span>
                <input type="number" id="xyviz-landmark-y" step="0.01" value="0" required>
              </label>
              <label class="xyviz-field">
                <span>Yaw (¬∞)</span>
                <input type="number" id="xyviz-landmark-yaw" step="1" value="0">
              </label>
              <div class="xyviz-form-actions">
                <button type="submit" class="xyviz-btn primary">Agregar landmark</button>
                <button type="button" id="xyviz-use-current" class="xyviz-btn">Usar robot actual</button>
              </div>
            </form>
            <div id="xyviz-landmark-list" class="xyviz-landmark-list">
              <div class="xyviz-landmark-empty">Agrega landmarks para monitorear posiciones de referencia.</div>
            </div>
          </div>
          <div class="xyviz-card">
            <h3>Distancias al landmark</h3>
            <div class="xyviz-selected-info">
              <div><strong>Seleccionado:</strong> <span id="xyviz-selected-name">‚Äî</span></div>
              <div>Distancia: <span id="xyviz-selected-distance">‚Äî</span></div>
              <div>ŒîX: <span id="xyviz-selected-dx">‚Äî</span> ¬∑ Error: <span id="xyviz-selected-dx-error">‚Äî</span></div>
              <div>ŒîY: <span id="xyviz-selected-dy">‚Äî</span> ¬∑ Error: <span id="xyviz-selected-dy-error">‚Äî</span></div>
              <div>ŒîYaw: <span id="xyviz-selected-dyaw">‚Äî</span> ¬∑ Error: <span id="xyviz-selected-dyaw-error">‚Äî</span></div>
            </div>
            <small class="xyviz-note">El c√°lculo de error replica la pesta√±a de Calibraci√≥n, tomando la posici√≥n del landmark como valor deseado.</small>
          </div>
        </aside>
        <div class="xyviz-stage">
          <div class="xyviz-canvas-wrap">
            <canvas id="xyviz-canvas"></canvas>
            <div class="xyviz-placeholder" id="xyviz-placeholder">Con√©ctate a ROS para visualizar el plano.</div>
          </div>
          <div class="xyviz-telemetry">
            <div>Robot: <span id="xyviz-robot-pose">‚Äî</span></div>
            <div>Lectura: <span id="xyviz-last-update">‚Äî</span></div>
          </div>
        </div>
      </div>
    </section>


    <section id="calibracion" style="display:none;">
      <h2>Calibraci√≥n</h2>
      <div class="calib-layout">
        <aside class="calib-settings">
          <h3>Objetivos y offsets</h3>
          <form class="calib-form">
            <fieldset>
              <legend>Valores deseados</legend>
              <label class="calib-field">
                <span>X (m)</span>
                <input type="number" id="calib-desired-x" step="0.01" value="0">
              </label>
              <label class="calib-field">
                <span>Y (m)</span>
                <input type="number" id="calib-desired-y" step="0.01" value="0">
              </label>
              <label class="calib-field">
                <span id="calib-desired-theta-label">Yaw (rad)</span>
                <input type="number" id="calib-desired-theta" step="0.01" value="0">
              </label>
            </fieldset>
            <fieldset>
              <legend>Offsets aplicados (medido + offset)</legend>
              <label class="calib-field">
                <span>Offset X (m)</span>
                <input type="number" id="calib-offset-x" step="0.01" value="0">
              </label>
              <label class="calib-field">
                <span>Offset Y (m)</span>
                <input type="number" id="calib-offset-y" step="0.01" value="0">
              </label>
              <label class="calib-field">
                <span id="calib-offset-theta-label">Offset yaw (rad)</span>
                <input type="number" id="calib-offset-theta" step="0.01" value="0">
              </label>
            </fieldset>
          </form>
          <div class="calib-angle-toggle">
            <button type="button" id="calib-toggle-angle-mode" class="calib-toggle-btn">Ver en grados</button>
            <span id="calib-angle-mode-hint">Mostrando √°ngulos en radianes.</span>
          </div>
          <small class="calib-note">Los offsets se suman a las mediciones antes de compararlas con los valores deseados.</small>
        </aside>
        <div class="calib-results">
          <article class="calib-card">
            <header class="calib-card-header">
              <div>
                <h4>Odometr√≠a ¬∑ Encoders</h4>
                <span class="calib-topic">/diff_drive_controller/odom</span>
              </div>
              <div class="calib-header-meta">
                <span id="calib-encoders-status" class="calib-status-chip calib-status-off">Sin conexi√≥n</span>
                <time id="calib-encoders-stamp" class="calib-timestamp">‚Äî</time>
              </div>
            </header>
            <ul class="calib-axis-list">
              <li>
                <span class="axis-label">X</span>
                <span class="axis-value" id="calib-encoders-x">‚Äî</span>
                <span class="axis-diff" id="calib-encoders-x-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-encoders-x-error">Error: ‚Äî</span>
              </li>
              <li>
                <span class="axis-label">Y</span>
                <span class="axis-value" id="calib-encoders-y">‚Äî</span>
                <span class="axis-diff" id="calib-encoders-y-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-encoders-y-error">Error: ‚Äî</span>
              </li>
              <li>
                <span class="axis-label">Yaw</span>
                <span class="axis-value" id="calib-encoders-theta">‚Äî</span>
                <span class="axis-diff" id="calib-encoders-theta-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-encoders-theta-error">Error: ‚Äî</span>
              </li>
            </ul>
            <div class="calib-distance">Distancia vs deseado: <span id="calib-encoders-distance">‚Äî</span></div>
          </article>

          <article class="calib-card">
            <header class="calib-card-header">
              <div>
                <h4>Odometr√≠a ¬∑ Filtro IMU</h4>
                <span class="calib-topic">/odometry/filtered</span>
              </div>
              <div class="calib-header-meta">
                <span id="calib-filtered-status" class="calib-status-chip calib-status-off">Sin conexi√≥n</span>
                <time id="calib-filtered-stamp" class="calib-timestamp">‚Äî</time>
              </div>
            </header>
            <ul class="calib-axis-list">
              <li>
                <span class="axis-label">X</span>
                <span class="axis-value" id="calib-filtered-x">‚Äî</span>
                <span class="axis-diff" id="calib-filtered-x-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-filtered-x-error">Error: ‚Äî</span>
              </li>
              <li>
                <span class="axis-label">Y</span>
                <span class="axis-value" id="calib-filtered-y">‚Äî</span>
                <span class="axis-diff" id="calib-filtered-y-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-filtered-y-error">Error: ‚Äî</span>
              </li>
              <li>
                <span class="axis-label">Yaw</span>
                <span class="axis-value" id="calib-filtered-theta">‚Äî</span>
                <span class="axis-diff" id="calib-filtered-theta-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-filtered-theta-error">Error: ‚Äî</span>
              </li>
            </ul>
            <div class="calib-distance">Distancia vs deseado: <span id="calib-filtered-distance">‚Äî</span></div>
          </article>

          <article class="calib-card">
            <header class="calib-card-header">
              <div>
                <h4>IMU</h4>
                <span class="calib-topic">/imu/data</span>
              </div>
              <div class="calib-header-meta">
                <span id="calib-imu-status" class="calib-status-chip calib-status-off">Sin conexi√≥n</span>
                <time id="calib-imu-stamp" class="calib-timestamp">‚Äî</time>
              </div>
            </header>
            <ul class="calib-axis-list">
              <li>
                <span class="axis-label">Yaw</span>
                <span class="axis-value" id="calib-imu-theta">‚Äî</span>
                <span class="axis-diff" id="calib-imu-theta-diff">Diff: ‚Äî</span>
                <span class="axis-error" id="calib-imu-theta-error">Error: ‚Äî</span>
              </li>
            </ul>
            <div class="calib-imu-group">
              <h5>Velocidad angular (rad/s)</h5>
              <div class="calib-imu-vec">
                <span>X: <span id="calib-imu-ang-x">‚Äî</span></span>
                <span>Y: <span id="calib-imu-ang-y">‚Äî</span></span>
                <span>Z: <span id="calib-imu-ang-z">‚Äî</span></span>
              </div>
            </div>
            <div class="calib-imu-group">
              <h5>Aceleraci√≥n lineal (m/s¬≤)</h5>
              <div class="calib-imu-vec">
                <span>X: <span id="calib-imu-lin-x">‚Äî</span></span>
                <span>Y: <span id="calib-imu-lin-y">‚Äî</span></span>
                <span>Z: <span id="calib-imu-lin-z">‚Äî</span></span>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

  <section id="mapa">
    <h2>Visualizaci√≥n del Mapa</h2>
    <div id="slam-status">
      <span id="slam-status-dot" class="status-dot status-unknown"></span>
      <span>
        <span id="slam-status-text">SLAMToolbox: Sin datos</span>
        <span id="slam-last-update" style="display:block;color:#777;font-size:0.85em;">√öltima actualizaci√≥n: ‚Äî</span>
      </span>
    </div>
    <div class="mapa-layout">
      <div class="mapa-sidebar">
        <div class="slam-card">
          <h3>T√≥picos publicados</h3>
          <div class="slam-card-body">
            <article class="slam-entry">
              <header>
                <h4>/map <small>(nav_msgs/OccupancyGrid)</small></h4>
              </header>
              <p>Mapa de ocupaci√≥n global derivado del grafo de poses. Se muestra abajo en tiempo real.</p>
              <button id="btn-request-dynamic-map" class="slam-action-btn">Solicitar snapshot v√≠a /slam_toolbox/dynamic_map</button>
              <pre id="slam-map-meta" class="slam-meta">Dimensiones: ‚Äî ¬∑ Resoluci√≥n: ‚Äî ¬∑ Origen: ‚Äî</pre>
            </article>
            <article class="slam-entry">
              <header>
                <h4>/slam_toolbox/pose <small>(geometry_msgs/PoseStamped)</small></h4>
              </header>
              <p>Pose estimada del robot en el marco del mapa; se refleja con la flecha azul.</p>
              <pre id="slam-pose-output" class="slam-meta">Sin datos</pre>
            </article>
          </div>
        </div>
        <div class="slam-card">
          <h3>Servicios slam_toolbox</h3>
          <div class="slam-card-body slam-services">
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/clear_changes" data-slam-type="slam_toolbox/Clear">Limpiar cambios pendientes</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/deserialize_map" data-slam-type="slam_toolbox/DeserializePoseGraph" data-requires-input="filename">Cargar mapa serializado</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/manual_loop_closure" data-slam-type="slam_toolbox/LoopClosure" data-requires-input="poses">Forzar loop closure manual</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/pause_new_measurements" data-slam-type="slam_toolbox/Pause">Pausar nuevas mediciones</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/save_map" data-slam-type="slam_toolbox/SaveMap" data-requires-input="output">Guardar mapa</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/serialize_map" data-slam-type="slam_toolbox/SerializePoseGraph" data-requires-input="target">Serializar mapa</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/toggle_interactive_mode" data-slam-type="slam_toolbox/ToggleInteractive">Alternar modo interactivo</button>
            <button class="slam-action-btn" data-slam-service="/slam_toolbox/reset" data-slam-type="slam_toolbox/Reset">Reiniciar mapa</button>
          </div>
          <div id="slam-service-feedback" class="slam-meta" style="margin-top:0.5em;">Selecciona un servicio para ejecutarlo.</div>
        </div>
      </div>
      <div class="mapa-viewer">
        <div class="mapa-viewer-header">
          <h3>Mapa en vivo</h3>
          <span class="mapa-viewer-subtitle">Plano XY manual ¬∑ Pose: /slam_toolbox/pose</span>
        </div>
        <div class="xy-controls">
          <form id="xy-poi-form" class="xy-poi-form">
            <label for="xy-poi-name" class="xy-field">
              <span>Etiqueta</span>
              <input type="text" id="xy-poi-name" name="name" placeholder="Punto" maxlength="32">
            </label>
            <label for="xy-poi-x" class="xy-field">
              <span>X (m)</span>
              <input type="number" id="xy-poi-x" name="x" step="0.01" value="0">
            </label>
            <label for="xy-poi-y" class="xy-field">
              <span>Y (m)</span>
              <input type="number" id="xy-poi-y" name="y" step="0.01" value="0">
            </label>
            <label for="xy-poi-yaw" class="xy-field">
              <span>Yaw (¬∞)</span>
              <input type="number" id="xy-poi-yaw" name="yaw" step="1" value="0">
            </label>
            <button type="submit" class="xy-add-btn">Agregar punto</button>
            <button type="button" id="xy-poi-use-current" class="xy-add-current">Usar pose actual</button>
          </form>
        </div>
        <div id="mapa-canvas" class="mapa-canvas">
          <div class="mapa-placeholder">Con√©ctate a ROS para visualizar el mapa.</div>
        </div>
        <div id="xy-poi-list" class="xy-poi-list">
          <div class="xy-poi-empty">Agrega puntos para destacarlos en el plano.</div>
        </div>
      </div>
    </div>
  </section>


    <section id="monitoreo" style="display:none;">
      <h2>Monitoreo de T√≥picos en Tiempo Real</h2>
      <div style="display: flex; align-items: center; gap: 1em; margin-bottom: 0.7em;">
        <label for="monit-dropdown-topico"><b>Selecciona T√≥pico:</b></label>
        <select id="monit-dropdown-topico" style="min-width:220px;"></select>
        <button id="monit-add-btn" style="margin-left:0.5em;">Monitorear</button>
        <label for="monit-frecuencia" style="margin-left:1.3em;"><b>Frecuencia (Hz):</b></label>
        <input type="number" id="monit-frecuencia" value="3" min="0.5" max="30" step="0.5" style="width:60px; margin-left:0.3em;">
        <span id="monit-frecuencia-texto" style="color:#888; font-size:0.95em;">(default: 3 Hz)</span>
      </div>
      
      <div id="monit-lista-topicos" style="margin-top:1.5em;"></div>
          </section>
    
  </main>
  <script src="dashboard.js"></script>
</body>
</html>
